{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "description": "Renovate configuration for Secretly project dependency management",
  "extends": [
    "config:base",
    "security:openssf-scorecard",
    ":dependencyDashboard",
    ":semanticCommits",
    ":separatePatchReleases",
    ":ignoreUnstable"
  ],
  "timezone": "America/New_York",
  "schedule": [
    "before 6am on monday"
  ],
  "labels": [
    "dependencies",
    "renovate"
  ],
  "assignees": ["@colibrisec/maintainers"],
  "reviewers": ["@colibrisec/maintainers"],
  "prConcurrentLimit": 5,
  "branchConcurrentLimit": 10,
  "enabledManagers": [
    "npm",
    "docker-compose",
    "dockerfile",
    "github-actions",
    "helm-values",
    "kubernetes"
  ],
  "packageRules": [
    {
      "description": "Critical security updates - immediate",
      "matchPackagePatterns": ["*"],
      "matchUpdateTypes": ["patch"],
      "matchCurrentVersion": "!/^0/",
      "vulnerabilityAlerts": true,
      "schedule": ["at any time"],
      "prPriority": 10,
      "automerge": true,
      "automergeType": "branch",
      "platformAutomerge": true,
      "labels": ["security", "automerge"]
    },
    {
      "description": "Node.js and npm major versions",
      "matchPackageNames": ["node", "npm"],
      "matchUpdateTypes": ["major"],
      "schedule": ["before 6am on the first day of the month"],
      "prPriority": -5,
      "labels": ["major-update", "nodejs"],
      "reviewers": ["@colibrisec/security-team"]
    },
    {
      "description": "Slack SDK updates",
      "matchPackagePatterns": ["@slack/*"],
      "prPriority": 5,
      "labels": ["slack-sdk"],
      "schedule": ["before 6am on monday"],
      "automerge": false
    },
    {
      "description": "Security and crypto packages",
      "matchPackagePatterns": ["*security*", "*crypto*", "*auth*"],
      "prPriority": 8,
      "labels": ["security"],
      "automerge": false,
      "reviewers": ["@colibrisec/security-team"]
    },
    {
      "description": "Database packages",
      "matchPackageNames": ["pg", "redis", "postgresql", "@types/pg"],
      "prPriority": 6,
      "labels": ["database"],
      "schedule": ["before 6am on monday"]
    },
    {
      "description": "Development dependencies",
      "matchDepTypes": ["devDependencies"],
      "matchUpdateTypes": ["minor", "patch"],
      "automerge": true,
      "automergeType": "branch",
      "labels": ["dev-dependencies"]
    },
    {
      "description": "GitHub Actions",
      "matchManagers": ["github-actions"],
      "prPriority": 3,
      "labels": ["github-actions"],
      "automerge": true,
      "automergeType": "branch"
    },
    {
      "description": "Docker base images",
      "matchManagers": ["dockerfile"],
      "matchPackageNames": ["node", "postgres", "redis"],
      "prPriority": 7,
      "labels": ["docker", "base-image"],
      "schedule": ["before 6am on monday"]
    },
    {
      "description": "Helm chart dependencies",
      "matchManagers": ["helm-values"],
      "matchFileNames": ["helm/secretly/Chart.yaml"],
      "prPriority": 4,
      "labels": ["helm", "kubernetes"]
    },
    {
      "description": "Alpine packages in Dockerfile",
      "matchManagers": ["dockerfile"],
      "matchPackagePatterns": ["apk:*"],
      "prPriority": 2,
      "labels": ["alpine", "system-packages"],
      "schedule": ["before 6am on the first day of the month"]
    }
  ],
  "vulnerabilityAlerts": {
    "enabled": true,
    "schedule": ["at any time"],
    "prPriority": 10,
    "labels": ["security", "vulnerability"]
  },
  "osvVulnerabilityAlerts": true,
  "lockFileMaintenance": {
    "enabled": true,
    "schedule": ["before 6am on sunday"],
    "automerge": true,
    "automergeType": "branch",
    "prTitle": "Lock file maintenance",
    "labels": ["lock-file-maintenance"]
  },
  "docker": {
    "enabled": true,
    "pinDigests": true
  },
  "dockerfile": {
    "enabled": true
  },
  "kubernetes": {
    "enabled": true,
    "fileMatch": ["helm/.+\\.yaml$"]
  },
  "helm-values": {
    "enabled": true,
    "fileMatch": ["helm/.+/values\\.yaml$", "helm/.+/Chart\\.yaml$"]
  },
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update Alpine package versions in Dockerfile",
      "fileMatch": ["Dockerfile$"],
      "matchStrings": [
        "apk add --no-cache (?<depName>\\S+?)=(?<currentValue>\\S+?)(?:\\s|$)"
      ],
      "datasourceTemplate": "repology",
      "versioningTemplate": "loose"
    }
  ],
  "prHeader": "This PR contains dependency updates managed by [Renovate](https://github.com/renovatebot/renovate).",
  "prFooter": "ðŸ¤– This dependency update was automatically generated by Renovate Bot.\n\n---\n\n**Security Notice**: All dependency updates are automatically scanned for vulnerabilities. High/Critical security updates are prioritized and may be auto-merged after CI passes.",
  "commitMessageTopic": "{{depName}}",
  "commitMessageAction": "Update",
  "commitMessageExtra": "to {{#if isPinDigest}}{{{newDigestShort}}}{{else}}{{#if isMajor}}{{prettyNewMajor}}{{else}}{{#if isSingleVersion}}{{prettyNewVersion}}{{else}}{{#if newValue}}{{{newValue}}}{{else}}{{{newDigestShort}}}{{/if}}{{/if}}{{/if}}{{/if}}",
  "commitBodyTable": true
}